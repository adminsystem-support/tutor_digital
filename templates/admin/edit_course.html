{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <h1 class="mb-5 text-primary border-bottom pb-3">
        <i class="bi bi-pencil-square me-3"></i> Edit Kursus: {{ course.title }}
    </h1>

    <!-- Card Konten Utama dengan Shadow dan Border Radius -->
    <div class="card shadow-lg p-5 border-0 rounded-4">
        <!-- PENTING: Tambahkan enctype="multipart/form-data" untuk mengizinkan upload file -->
        <form method="POST" action="{{ url_for('edit_course', course_id=course.id) }}" enctype="multipart/form-data">
            {{ form.hidden_tag() }}
            
            <div class="row g-5">
                <!-- Kolom Kiri: Info Dasar & Media -->
                <div class="col-md-6 border-end pe-md-5">
                    
                    <!-- INFORMASI DASAR -->
                    <h4 class="text-primary mb-4 pb-2 border-bottom"><i class="bi bi-info-circle-fill me-2"></i> Informasi Dasar</h4>
                    
                    <div class="mb-4">
                        {{ form.title.label(class="form-label fw-bold text-dark") }}
                        {{ form.title(class="form-control form-control-lg", placeholder="Contoh: Full-Stack Web Developer dengan Flask") }}
                        {% for error in form.title.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-4">
                        {{ form.description.label(class="form-label fw-bold text-dark") }}
                        {{ form.description(class="form-control", rows=5, placeholder="Jelaskan apa yang akan dipelajari di kursus ini...") }}
                        {% for error in form.description.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>

                    <div class="mb-5">
                        {{ form.category.label(class="form-label fw-bold text-dark") }}
                        {{ form.category(class="form-select form-select-lg") }} 
                        {% for error in form.category.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <!-- MEDIA & HARGA -->
                    <h4 class="text-primary mb-4 pb-2 border-bottom"><i class="bi bi-tags-fill me-2"></i> Media & Harga</h4>
                    
                    <!-- FIELD UPLOAD GAMBAR KURSUS -->
                    <div class="mb-4">
                        {{ form.image.label(class="form-label fw-bold text-dark") }} 
                        
                        <!-- Pratinjau Gambar Saat Ini -->
                        <div class="mb-3 p-3 border rounded bg-light text-center">
                            <p class="form-text text-muted mb-2">Gambar Sampul Saat Ini:</p>
                            {% if course.image_url %}
                                <img src="{{ url_for('static', filename='uploads/' + course.image_url) }}" alt="Gambar Kursus" class="img-thumbnail" style="max-height: 150px; object-fit: cover;">
                            {% else %}
                                <i class="bi bi-image-fill text-secondary fs-1"></i>
                                <p class="text-muted small">Belum ada gambar diunggah.</p>
                            {% endif %}
                            <!-- Hidden field untuk menyimpan URL/path lama jika tidak ada upload baru -->
                            <input type="hidden" name="current_image_url" value="{{ course.image_url }}">
                        </div>
                        
                        <!-- Input File -->
                        {{ form.image(class="form-control", accept="image/*") }} 
                        <div class="form-text">Unggah gambar baru (JPG, PNG) untuk mengganti yang lama.</div>
                        {% for error in form.image.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <!-- END FIELD UPLOAD GAMBAR KURSUS -->
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            {{ form.price.label(class="form-label fw-bold text-dark") }}
                            <div class="input-group">
                                <span class="input-group-text">Rp</span>
                                {{ form.price(class="form-control", placeholder="0") }}
                            </div>
                            {% for error in form.price.errors %}
                                <div class="text-danger small mt-1">{{ error }}</div>
                            {% endfor %}
                        </div>
                        <div class="col-md-6 mb-4">
                            {{ form.discount_percent.label(class="form-label fw-bold text-dark") }}
                            <div class="input-group">
                                {{ form.discount_percent(class="form-control", placeholder="0") }}
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Kolom Kanan: Info Instruktur -->
                <div class="col-md-6 ps-md-5">
                    <h4 class="text-primary mb-4 pb-2 border-bottom"><i class="bi bi-person-badge-fill me-2"></i> Informasi Instruktur</h4>
                    
                    <div class="mb-4">
                        {{ form.instructor_name.label(class="form-label fw-bold text-dark") }}
                        {{ form.instructor_name(class="form-control", placeholder="Nama Lengkap Instruktur") }}
                        {% for error in form.instructor_name.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-4">
                        {{ form.instructor_title.label(class="form-label fw-bold text-dark") }}
                        {{ form.instructor_title(class="form-control", placeholder="Contoh: Senior Developer") }}
                    </div>
                    
                    <!-- FIELD UPLOAD FOTO INSTRUKTUR -->
                    <div class="mb-4">
                        {{ form.instructor_image.label(class="form-label fw-bold text-dark") }}
                        
                        <!-- Pratinjau Foto Saat Ini -->
                        <div class="mb-3 p-3 border rounded bg-light text-center" style="max-width: 180px;">
                            <p class="form-text text-muted mb-2">Foto Instruktur Saat Ini:</p>
                            {% if course.instructor_image_url %}
                                <img src="{{ url_for('static', filename='uploads/' + course.instructor_image_url) }}" alt="Foto Instruktur" class="img-thumbnail rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                            {% else %}
                                <i class="bi bi-person-circle text-secondary fs-1"></i>
                                <p class="text-muted small">Belum ada foto diunggah.</p>
                            {% endif %}
                            <input type="hidden" name="current_instructor_image_url" value="{{ course.instructor_image_url }}">
                        </div>
                        
                        <!-- Input File -->
                        {{ form.instructor_image(class="form-control", accept="image/*") }}
                        <div class="form-text">Unggah foto baru (JPG, PNG) untuk mengganti yang lama.</div>
                        {% for error in form.instructor_image.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <!-- END FIELD UPLOAD FOTO INSTRUKTUR -->
                    
                    <div class="mb-4">
                        {{ form.rating.label(class="form-label fw-bold text-dark") }}
                        {{ form.rating(class="form-control", placeholder="4.5") }}
                        {% for error in form.rating.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <hr class="my-5">
            
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('admin_courses') }}" class="btn btn-outline-secondary btn-lg px-4">
                    <i class="bi bi-arrow-left me-2"></i> Batal
                </a>
                {{ form.submit(class="btn btn-primary btn-lg px-5 shadow-sm", value="Simpan Perubahan") }}
            </div>
        </form>
    </div>

    <!-- BAGIAN PELAJARAN -->
    <h3 class="mt-5 mb-3 text-primary border-bottom pb-2"><i class="bi bi-list-task me-2"></i> Pelajaran Kursus</h3>
    <div class="card shadow-lg p-4 border-0 rounded-4">
        <div class="d-flex justify-content-end mb-3">
            <a href="{{ url_for('add_lesson', course_id=course.id) }}" class="btn btn-info"><i class="bi bi-plus-lg me-2"></i> Tambah Pelajaran Baru</a>
        </div>
        
        {% if course.lessons.count() > 0 %}
        <div class="list-group">
            {% for lesson in course.lessons.order_by(Lesson.order).all() %}
            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center mb-2 rounded-3 border-start border-primary border-5 p-3 hover-scale">
                <div class="d-flex align-items-center">
                    <span class="badge bg-primary me-3 fs-6">#{{ lesson.order }}</span>
                    <a href="{{ url_for('edit_lesson', lesson_id=lesson.id) }}" class="fw-bold text-dark text-decoration-none">{{ lesson.title }}</a>
                </div>
                <div>
                    <a href="{{ url_for('edit_lesson', lesson_id=lesson.id) }}" class="btn btn-sm btn-outline-warning me-2" title="Edit Pelajaran"><i class="bi bi-pencil-fill"></i></a>
                    <form method="POST" action="{{ url_for('delete_lesson', lesson_id=lesson.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Yakin ingin menghapus pelajaran ini?')" title="Hapus Pelajaran"><i class="bi bi-trash-fill"></i></button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info text-center p-4" role="alert">
            <i class="bi bi-exclamation-circle me-2"></i> Kursus ini belum memiliki pelajaran.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
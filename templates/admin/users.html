{% extends "admin/dashboard.html" %}

{% block admin_content %}

<!-- PERBAIKAN: Bungkus konten di dalam container untuk membatasi lebar -->
<div class="container"> 

    <!-- Header dan Tombol Tambah Pengguna -->
    <div class="d-flex justify-content-between align-items-center mb-5 border-bottom pb-3">
        <!-- Judul menggunakan warna aksen Primary (Cyan) dan ukuran yang lebih besar -->
        <h2 class="fw-bolder text-primary"><i class="bi bi-people-fill me-3"></i> Manajemen Pengguna</h2>
        
        <!-- TOMBOL TAMBAH PENGGUNA BARU (Menggunakan btn-primary Cyan) -->
        <a href="{{ url_for('admin_add_user') }}" class="btn btn-primary fw-bold hover-scale shadow-sm px-4">
            <i class="bi bi-person-plus-fill me-2"></i> Tambah Pengguna Baru
        </a>
    </div>

    <!-- Tabel Pengguna (Menggunakan Card Shadow dan Table Striped) -->
    <div class="card shadow-lg p-4 border-0 rounded-4">
        <div class="table-responsive">
            <!-- Menggunakan table-striped dan table-hover untuk tampilan bersih -->
            <table class="table table-striped table-hover align-middle mb-0">
                <thead class="table-primary">
                    <tr>
                        <th scope="col" class="text-center">ID</th>
                        <th scope="col">Username</th>
                        <th scope="col">Email</th>
                        <th scope="col" class="text-center">Status</th>
                        <th scope="col" class="text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <th scope="row" class="text-center text-muted">{{ user.id }}</th>
                        <td>
                            <!-- Link menggunakan warna aksen Dark Slate/Dark -->
                            <a href="{{ url_for('admin_user_detail', user_id=user.id) }}" class="fw-bold text-dark text-decoration-none hover-primary">{{ user.username }}</a>
                            <br><small class="text-muted">{{ Enrollment.query.filter_by(user_id=user.id, is_confirmed=True).count() }} Kursus Aktif</small>
                        </td>
                        <td>{{ user.email }}</td>
                        <td class="text-center">
                            {% if user.is_admin %}
                                <!-- Badge Admin Merah/Danger -->
                                <span class="badge bg-danger"><i class="bi bi-shield-fill me-1"></i> Admin</span>
                            {% else %}
                                <!-- Badge Pengguna Biasa -->
                                <span class="badge bg-secondary"><i class="bi bi-person-fill me-1"></i> Pengguna</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            {% if user.id != current_user.id %}
                                <!-- PERBAIKAN: Gunakan btn-group-vertical untuk tampilan yang lebih rapi dan terpusat -->
                                <div class="btn-group-vertical btn-group-sm" role="group">
                                    <!-- Tombol Reset Password -->
                                    <form method="POST" action="{{ url_for('admin_reset_password', user_id=user.id) }}" class="d-inline">
                                        <button type="submit" class="btn btn-outline-secondary mb-1" 
                                                onclick="return confirm('Yakin ingin mereset password untuk {{ user.username }}? Password akan diatur ke: 123456')" 
                                                title="Reset Password" style="width: 120px;">
                                            <i class="bi bi-key-fill"></i> Reset Password
                                        </button>
                                    </form>
                                    
                                    <!-- Tombol Toggle Admin -->
                                    <a href="{{ url_for('admin_toggle_admin', user_id=user.id) }}" 
                                       class="btn fw-bold {% if user.is_admin %}btn-outline-danger{% else %}btn-outline-success{% endif %}"
                                       title="Ubah Status Admin" style="width: 120px;">
                                        {% if user.is_admin %}
                                            <i class="bi bi-person-x-fill"></i> Hapus Admin
                                        {% else %}
                                            <i class="bi bi-person-check-fill"></i> Jadikan Admin
                                        {% endif %}
                                    </a>
                                </div>
                            {% else %}
                                <span class="text-muted small"><i class="bi bi-person-fill me-1"></i> Anda</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if not users %}
        <div class="alert alert-info text-center mt-3" role="alert">
            <i class="bi bi-info-circle me-2"></i> Belum ada pengguna terdaftar.
        </div>
        {% endif %}
    </div>

</div> <!-- AKHIR PERBAIKAN: Tutup div container -->

{% endblock %}
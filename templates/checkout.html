{% extends "base.html" %}

{% block content %}
<h1 class="mb-4 text-primary"><i class="bi bi-credit-card-fill me-2"></i> Halaman Pembayaran</h1>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card glass-card p-4 shadow-lg">
            <h3 class="card-title mb-4 border-bottom pb-2">Ringkasan Pesanan</h3>
            
            <!-- SIMULASI KODE UNIK (3 digit acak) -->
            {% set unique_code = range(100, 999) | random %}
            {% set final_price_with_code = data.final_price + unique_code %}
            
            <!-- Ringkasan Harga -->
            <div class="d-flex justify-content-between mb-3">
                <span class="fw-bold">Kursus:</span>
                <span>{{ data.course.title }}</span>
            </div>
            
            <div class="d-flex justify-content-between mb-3">
                <span class="fw-bold">Harga Normal:</span>
                <span>Rp {{ data.course.price|format_rupiah }}</span>
            </div>
            
            {% set discount_amount = data.course.price * data.course.discount_percent / 100 %}
            {% if data.course.discount_percent > 0 %}
            <div class="d-flex justify-content-between mb-3 text-danger">
                <span class="fw-bold">Diskon ({{ data.course.discount_percent }}%):</span>
                <span>- Rp {{ discount_amount|format_rupiah }}</span>
            </div>
            {% endif %}
            
            <div class="d-flex justify-content-between mb-3 text-info">
                <span class="fw-bold">Kode Unik:</span>
                <span class="fw-bold">+ Rp {{ unique_code }}</span>
            </div>
            
            <hr>
            
            <div class="d-flex justify-content-between mb-4">
                <h4 class="fw-bold text-success">TOTAL PEMBAYARAN:</h4>
                <h4 class="fw-bold text-success">Rp {{ final_price_with_code|format_rupiah }}</h4>
            </div>
            
            <h3 class="card-title mb-3 border-bottom pb-2">Metode Pembayaran</h3>
            
            <!-- FORMULIR KONFIRMASI PEMBAYARAN -->
            <form method="POST" action="{{ url_for('confirm_payment_upload', course_id=data.course.id) }}" enctype="multipart/form-data">
                
                <!-- Input tersembunyi untuk Kode Unik -->
                <input type="hidden" name="unique_code" value="{{ unique_code }}">
                
                <!-- Navigasi Tab Metode Pembayaran -->
                <ul class="nav nav-tabs mb-3" id="paymentTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="bank-tab" data-bs-toggle="tab" data-bs-target="#bank" type="button" role="tab" aria-controls="bank" aria-selected="true"><i class="bi bi-bank me-1"></i> Transfer Bank</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="e-wallet-tab" data-bs-toggle="tab" data-bs-target="#e-wallet" type="button" role="tab" aria-controls="e-wallet" aria-selected="false"><i class="bi bi-wallet-fill me-1"></i> E-Wallet</button>
                    </li>
                </ul>

                <!-- Konten Tab Metode Pembayaran -->
                <div class="tab-content" id="paymentTabContent">
                    
                    <!-- Tab 1: Transfer Bank -->
                    <div class="tab-pane fade show active" id="bank" role="tabpanel" aria-labelledby="bank-tab">
                        <div class="form-check alert alert-light border text-start">
                            <input class="form-check-input" type="radio" name="payment_method" id="bcaRadio" value="BCA" required>
                            <label class="form-check-label w-100" for="bcaRadio">
                                <h5 class="fw-bold text-primary">Bank Central Asia (BCA)</h5>
                                <p class="mb-1">Nomor Rekening: <span class="fw-bold text-dark">1234567890</span></p>
                                <p class="mb-0 text-danger small">Mohon transfer sesuai nominal: <span class="fw-bold">Rp {{ final_price_with_code|format_rupiah }}</span></p>
                            </label>
                        </div>
                        <div class="form-check alert alert-light border text-start">
                            <input class="form-check-input" type="radio" name="payment_method" id="mandiriRadio" value="Mandiri">
                            <label class="form-check-label w-100" for="mandiriRadio">
                                <h5 class="fw-bold text-primary">Bank Mandiri</h5>
                                <p class="mb-1">Nomor Rekening: <span class="fw-bold text-dark">9876543210</span></p>
                                <p class="mb-0 text-danger small">Mohon transfer sesuai nominal: <span class="fw-bold">Rp {{ final_price_with_code|format_rupiah }}</span></p>
                            </label>
                        </div>
                    </div>

                    <!-- Tab 2: E-Wallet -->
                    <div class="tab-pane fade" id="e-wallet" role="tabpanel" aria-labelledby="e-wallet-tab">
                        <div class="form-check alert alert-light border text-start">
                            <input class="form-check-input" type="radio" name="payment_method" id="danaRadio" value="DANA">
                            <label class="form-check-label w-100" for="danaRadio">
                                <h5 class="fw-bold text-primary">DANA</h5>
                                <p class="mb-1">Nomor Telepon: <span class="fw-bold text-dark">0812-3456-7890</span></p>
                                <p class="mb-0 text-danger small">Mohon transfer sesuai nominal: <span class="fw-bold">Rp {{ final_price_with_code|format_rupiah }}</span></p>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Field Upload Bukti Bayar -->
                <h5 class="mt-4 mb-3 border-bottom pb-2">Upload Bukti Pembayaran</h5>
                <div class="mb-3">
                    <label for="proof_file" class="form-label">Bukti Transfer (PNG, JPG, PDF)</label>
                    <input class="form-control" type="file" id="proof_file" name="proof_file" required>
                </div>

                <!-- Tombol Konfirmasi Pembayaran -->
                <div class="mt-4 text-center">
                    <button type="submit" class="btn btn-lg btn-success w-75">
                        <i class="bi bi-whatsapp me-2"></i> Konfirmasi Pembayaran
                    </button>
                    <p class="mt-2 text-muted small">Klik tombol di atas setelah Anda mengisi formulir dan mengunggah bukti transfer.</p>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}